# ワークフローアプリの設定方法

## 設定手順

### 1. Difyダッシュボードで情報を確認

1. Difyのワークフローアプリを開く
2. 左サイドバーから「API アクセス」をクリック
3. 以下の情報を確認：
   - **APIキー**: `app-xxxxxxxxxxxxx` の形式
   - **エンドポイント**: 通常は `https://api.dify.ai/v1` またはカスタムドメイン

### 2. DifyAppShareでアプリを登録

1. 「アプリを追加」ボタンをクリック
2. 以下の情報を入力：

   **アプリ名**: 任意の名前（例: "社内質問チャットボット"）

   **説明**: 任意（例: "社内の質問に答えるワークフロー"）

   **APIエンドポイント**: 
   - ワークフローアプリの場合: `https://api.dify.ai/v1/workflows/run`
   - または: `https://api.dify.ai/v1`（自動判定されます）

   **APIキー**: DifyダッシュボードからコピーしたAPIキー
   - 例: `app-9GP4roNElxRPyd2oNpksfpOC`

   **作成者名**: 任意

3. 「追加」をクリック

### 3. チャットで使用

1. チャットスペースで登録したアプリを選択
2. メッセージを入力して送信
3. ワークフローが実行され、結果が表示されます

## 注意事項

### ワークフローの入力変数

ワークフローアプリの場合、ユーザーの入力はワークフローの最初の入力変数に自動的に設定されます。

一般的な変数名:
- `question`
- `input`
- `text`
- `query`
- `message`
- `prompt`

**現在の実装では、`question`という変数名を想定しています。**

もしワークフローで異なる変数名を使用している場合、以下のいずれかの方法で対応できます：

1. **ワークフロー側で変数名を`question`に変更する**（推奨）
2. **将来的に、アプリ登録時に入力変数名を指定できる機能を追加予定**

### エンドポイントURLの自動判定

エンドポイントURLに `/workflows/run` が含まれている場合、自動的にワークフローアプリとして認識されます。

例:
- `https://api.dify.ai/v1/workflows/run` → ワークフローアプリ
- `https://api.dify.ai/v1` → チャットアプリ（デフォルト）

## トラブルシューティング

### エラー: "Missing required parameter: inputs"

ワークフローアプリの場合、`inputs`パラメータが必要です。現在の実装では、ユーザーの入力メッセージを`question`という変数名で`inputs`に設定しています。

ワークフローで異なる変数名を使用している場合は、ワークフロー側で変数名を`question`に変更するか、将来的な機能追加を待ってください。

### エラー: "API Error: 400"

1. APIキーが正しいか確認
2. ワークフローが「公開済み」になっているか確認
3. エンドポイントURLが正しいか確認

### レスポンスが表示されない

1. ブラウザのコンソールでエラーを確認
2. ネットワークタブでAPIリクエストの状態を確認
3. Difyのログでワークフローの実行状態を確認

## 参考

- [Dify API Documentation](https://docs.dify.ai/api-reference)
- [ワークフロー実行のためのリファレンス](https://docs.dify.ai/api-reference/workflows)

