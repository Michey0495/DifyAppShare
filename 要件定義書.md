# DifyAppShare 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
DifyAppShare（ディファイアプリシェア）

### 1.2 プロジェクトの目的
複数のDifyワークフローアプリケーションを統合管理し、ブラウザ上で簡単にチャットテストができる専用ウェブアプリケーションを提供する。研修参加者が作成したDifyアプリの実務での使用イメージを視覚的に理解できる環境を構築する。

### 1.3 背景
Difyワークフロー研修において、受講者が作成したAIアプリケーションが実際の業務でどのように活用されるかをイメージしにくい課題がある。複数のワークフローを同時に比較・検証できる環境を提供することで、実務での活用シーンを具体的に理解できるようにする。

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 ワークフロー登録機能
- **機能概要**: Difyで公開されたAIワークフローアプリケーションを登録・管理する
- **詳細要件**:
  - DifyアプリケーションのAPIエンドポイント（URL）を登録
  - APIキー（認証トークン）の設定
  - アプリケーション名、説明、作成者名などのメタデータを登録
  - 登録されたアプリケーションの一覧表示
  - アプリケーションの編集・削除機能
  - 最大登録数: 10件（デフォルト）

#### 2.1.2 マルチチャットセッション機能
- **機能概要**: 複数のチャットセッションを同時に管理・操作する
- **詳細要件**:
  - デフォルトで10個のチャットスペースを提供
  - 各スペースにDifyアプリケーションを割り当て可能
  - 各スペースで独立したチャットセッションを維持
  - 会話履歴の保存・表示
  - セッションのリセット機能
  - セッション名のカスタマイズ

#### 2.1.3 Dify API連携機能
- **機能概要**: DifyのチャットAPIと連携してメッセージ送受信を行う
- **詳細要件**:
  - Dify Chat API（POST /v1/chat-messages）へのリクエスト送信
  - ストリーミングレスポンスの受信・表示
  - エラーハンドリング（API接続エラー、タイムアウト等）
  - リトライ機能（失敗時の自動再試行）
  - レスポンス時間の表示

#### 2.1.4 チャットUI機能
- **機能概要**: 直感的で使いやすいチャットインターフェースを提供
- **詳細要件**:
  - メッセージ入力欄
  - 送信ボタン
  - メッセージ履歴の表示（ユーザー/アシスタントの区別）
  - タイムスタンプ表示
  - ローディングインジケーター
  - マークダウン形式のメッセージ表示
  - コードブロックのシンタックスハイライト

### 2.2 補助機能

#### 2.2.1 アプリケーション選択機能
- 各チャットスペースに割り当てるDifyアプリケーションを選択
- ドロップダウンまたはモーダルでの選択UI
- アプリケーション情報のプレビュー表示

#### 2.2.2 セッション管理機能
- セッションの保存（ローカルストレージまたはサーバー側）
- セッションの復元
- セッションのエクスポート（JSON形式）
- セッションのインポート

#### 2.2.3 比較機能
- 複数のセッションで同じ質問を同時実行
- 結果の並列表示による比較
- レスポンス時間の比較表示

#### 2.2.4 設定機能
- APIタイムアウト時間の設定
- リトライ回数の設定
- テーマ設定（ライト/ダークモード）
- 表示言語設定

---

## 3. 非機能要件

### 3.1 パフォーマンス要件
- ページ読み込み時間: 3秒以内
- APIレスポンス表示開始: 1秒以内
- 複数セッション同時実行時の安定性確保
- ブラウザのメモリ使用量を適切に管理

### 3.2 可用性要件
- ブラウザ対応: Chrome、Firefox、Safari、Edgeの最新版
- レスポンシブデザイン: タブレット・スマートフォンでも基本操作が可能
- オフライン時の適切なエラーメッセージ表示

### 3.3 ユーザビリティ要件
- 直感的な操作が可能なUI/UX
- 初回利用時のチュートリアルまたはヘルプ機能
- エラー時の分かりやすいメッセージ表示
- キーボードショートカットのサポート

### 3.4 保守性要件
- コードの可読性と保守性を重視した設計
- 適切なコメントとドキュメント
- モジュール化された構造

---

## 4. 技術要件

### 4.1 フロントエンド技術
- **フレームワーク**: React（Next.js推奨）またはVue.js
- **UIライブラリ**: Tailwind CSS、shadcn/ui、またはMaterial-UI
- **状態管理**: Zustand、Redux、またはContext API
- **HTTPクライアント**: AxiosまたはFetch API
- **ストリーミング処理**: Server-Sent Events（SSE）またはWebSocket

### 4.2 バックエンド技術（必要に応じて）
- **APIサーバー**: Node.js（Express）またはPython（FastAPI）
- **データベース**: SQLite（ローカル）またはPostgreSQL（サーバー側）
- **認証**: JWTまたはセッション管理

### 4.3 Dify API仕様
- **エンドポイント**: `https://api.dify.ai/v1/chat-messages`
- **認証方式**: Bearer Token（APIキー）
- **リクエスト形式**: JSON
- **レスポンス形式**: JSON（ストリーミング対応）

### 4.4 データストレージ
- **ローカルストレージ**: ブラウザのLocalStorageまたはIndexedDB
- **セッション情報**: メモリ内管理またはサーバー側DB

---

## 5. UI/UX要件

### 5.1 レイアウト設計
- **メインエリア**: 10個のチャットスペースをグリッドレイアウトで配置
- **サイドバー**: アプリケーション一覧・設定
- **ヘッダー**: プロジェクト名、設定ボタン、ヘルプボタン

### 5.2 チャットスペース設計
- **サイズ**: 各スペースは均等なサイズ（例: 2列×5行または5列×2行）
- **表示要素**:
  - アプリケーション名・アイコン
  - チャットエリア（スクロール可能）
  - 入力欄・送信ボタン
  - セッションリセットボタン
  - アプリケーション切り替えボタン

### 5.3 インタラクション設計
- **ドラッグ&ドロップ**: アプリケーションの割り当て変更
- **タブ切り替え**: スペースが多い場合のタブ表示
- **モーダル**: アプリケーション登録・編集画面
- **トースト通知**: エラー・成功メッセージの表示

### 5.4 デザイン方針
- **カラーパレット**: 研修用途に適した落ち着いた配色
- **タイポグラフィ**: 読みやすいフォントサイズと行間
- **アニメーション**: 過度でない適度な動きで操作感を向上

---

## 6. データ要件

### 6.1 データ構造

#### 6.1.1 アプリケーション情報
```json
{
  "id": "string",
  "name": "string",
  "description": "string",
  "apiEndpoint": "string",
  "apiKey": "string",
  "createdBy": "string",
  "createdAt": "datetime",
  "updatedAt": "datetime"
}
```

#### 6.1.2 チャットセッション情報
```json
{
  "sessionId": "string",
  "appId": "string",
  "messages": [
    {
      "id": "string",
      "role": "user|assistant",
      "content": "string",
      "timestamp": "datetime"
    }
  ],
  "createdAt": "datetime",
  "updatedAt": "datetime"
}
```

### 6.2 データ永続化
- アプリケーション情報: LocalStorageまたはサーバーDB
- チャット履歴: LocalStorage（ブラウザ側）またはサーバーDB
- 設定情報: LocalStorage

---

## 7. セキュリティ要件

### 7.1 APIキー管理
- APIキーの暗号化保存（可能な場合）
- APIキーの表示/非表示切り替え
- APIキーの再入力機能

### 7.2 データ保護
- 個人情報の適切な取り扱い
- チャット履歴のプライバシー保護
- CORS設定の適切な実装

### 7.3 エラーハンドリング
- APIキー漏洩の防止
- 不正なリクエストの検知
- 適切なエラーメッセージの表示（機密情報の漏洩防止）

---

## 8. 運用要件

### 8.1 デプロイメント
- 静的サイトとしてのホスティング可能（Vercel、Netlify等）
- 環境変数の適切な管理
- ビルド・デプロイの自動化

### 8.2 ログ・モニタリング
- エラーログの記録
- API呼び出しのログ記録（デバッグ用）
- パフォーマンス監視

### 8.3 バックアップ・復旧
- 設定データのエクスポート機能
- 設定データのインポート機能

---

## 9. 制約事項

### 9.1 技術的制約
- Dify APIの仕様に依存
- ブラウザの制限（LocalStorage容量等）
- CORSポリシーの制約

### 9.2 業務的制約
- 研修用途での利用を前提
- 同時接続数の制限（必要に応じて）
- 利用時間の制限（必要に応じて）

### 9.3 その他
- DifyのAPIレート制限に依存
- ネットワーク環境に依存

---

## 10. 今後の拡張性

### 10.1 機能拡張の可能性
- アプリケーション数の上限変更（10個以上）
- ユーザー認証機能の追加
- チーム共有機能の追加
- アプリケーションの評価・レビュー機能
- 使用統計の可視化

### 10.2 技術的拡張
- サーバー側APIの追加
- リアルタイム同期機能
- モバイルアプリ化

---

## 11. 参考資料

### 11.1 Dify API仕様
- Dify公式ドキュメント: https://docs.dify.ai/
- Dify API Reference: https://docs.dify.ai/api-reference

### 11.2 関連ドキュメント
- 研修カリキュラム資料
- Difyワークフローサンプル集

---

## 12. 承認・承認者

| 項目 | 内容 |
|------|------|
| 作成日 | 2025年1月27日 |
| 作成者 | システム開発チーム |
| 承認者 | （承認者名） |
| 承認日 | （承認日） |
| バージョン | 1.0 |

---

## 付録: 用語集

- **Dify**: AIアプリケーション開発プラットフォーム
- **ワークフロー**: Dify上で作成されるAI処理の流れ
- **チャットセッション**: ユーザーとAIアプリケーション間の対話セッション
- **APIエンドポイント**: 外部サービスと通信するためのURL
- **ストリーミング**: データを逐次送信する方式

