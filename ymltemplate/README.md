# DifyAppShare YAMLテンプレート

DifyAppShareアプリと連携するためのDify DSLテンプレート集。

---

## DifyAppShareが送る情報（重要）

DifyAppShareからDifyに送られるデータは以下の2つだけ。

チャットボット・チャットフローの場合:
- query: ユーザーが入力したテキスト
- files: 添付ファイル（アップロード済みID）

ワークフローの場合:
- inputs.question: ユーザーが入力したテキスト
- files: 添付ファイル（アップロード済みID）

ワークフローのStartノードで使える変数名は `question` に固定されている。
それ以外の入力変数を追加する場合は required: false（任意）にすること。
requiredにするとDifyAppShareから値が送られずエラーになる。

---

## 接続手順

1. Difyでアプリを作成し、公開する
2. 「バックエンドサービスAPI」のページでAPIキーを発行する
3. DifyAppShareでアプリを登録する:
   - アプリタイプ: チャットボット / チャットフロー / ワークフロー のいずれかを選択
   - APIエンドポイント: `http://dify-tutorial.ezoai.jp/v1`（ベースURLのみ）
   - APIキー: 発行した `app-` で始まるキーを貼り付け

エンドポイントはどのアプリタイプでも同じベースURLでよい。
DifyAppShareが自動的に正しいパスを付加する:
- チャットボット・チャットフロー → /v1/chat-messages
- ワークフロー → /v1/workflows/run
- ファイルアップロード → /v1/files/upload

---

## テンプレート一覧

### dify_template_saas_chat.yml（チャットボット型）

会話形式のアプリ。DifyAppShareからテキストとファイルを送ると、LLMが対話的に応答する。

- インポート後にやること: LLMモデルの選択、pre_promptの書き換え
- DifyAppShareでの登録時: アプリタイプ「チャットボット」を選択

### dify_template_saas_workflow.yml（ワークフロー型 基本）

Start → LLM → End の最小構成ワークフロー。

- Start変数: question（テキスト、必須）、file（ファイル、任意）
- インポート後にやること: LLMモデルの選択、プロンプトの書き換え
- DifyAppShareでの登録時: アプリタイプ「ワークフロー」を選択

### dify_template_saas_workflow_advanced.yml（ワークフロー型 多機能）

Start → LLM → End の構成。基本版との違いはLLMプロンプトが多機能対応になっている点。
分析・要約・翻訳・質問応答をユーザーの入力内容から自動判断する。

- Start変数: question（テキスト、必須）、file（ファイル、任意）
- インポート後にやること: LLMモデルの選択、プロンプトの書き換え
- DifyAppShareでの登録時: アプリタイプ「ワークフロー」を選択

### dify_template_workflow_report_generator.yml（週次報告書ジェネレーター）

Start → LLM x5 → End の7ノード構成。プロジェクトの進捗メモを入力すると、
5段階のLLM処理を経て、上司に提出可能な週次報告書を自動生成する。

処理の流れ:
1. STEP1 情報抽出: 入力テキストからプロジェクト情報を項目別に整理
2. STEP2 定量分析: 進捗率・スケジュール遵守率を数値で評価
3. STEP3 リスク評価: 遅延やボトルネックからリスクを識別
4. STEP4 改善提案: リスクに対する具体的アクションを3つ提案
5. STEP5 報告書生成: 全分析結果を統合し整形済み報告書を出力

- Start変数: question（テキスト、必須）、file（ファイル、任意）
- インポート後にやること: 5つのLLMノードすべてでモデルを選択する
- DifyAppShareでの登録時: アプリタイプ「ワークフロー」を選択
- 注意: LLM5段チェーンのため、実行に30秒〜1分程度かかる

テスト用のサンプル入力テキスト:

```
プロジェクトPhoenixの今週の進捗です。UIデザインのレビューが完了し、
クライアント承認も取れました。フロントエンド実装は全体の70%まで進んでいます。
ログイン画面とダッシュボードは完成済みで、レポート画面のグラフ表示に着手中です。
バックエンドAPIは認証モジュールが完了、データ取得APIも8割方できています。
ただしファイルアップロード機能で想定外のバグが見つかり、2日ほど遅延しています。
原因はマルチパートフォームデータの処理部分です。テスト環境の構築は来週からの
予定でしたが、インフラ担当の山田さんがインフルエンザで今週いっぱい不在のため、
着手が遅れる見込みです。来週はレポート画面の完成、ファイルアップロードのバグ修正、
テスト環境の構築開始を予定しています。クライアントへの中間報告が再来週に
控えているため、デモ可能な状態にする必要があります。
```

---

## Difyでアプリを自作する場合のルール

DifyAppShareと連携するアプリを自分で作る場合、以下を守ること。

チャットボット・チャットフロー:
- 特別な制約なし。通常どおりDifyでアプリを作ればDifyAppShareから使える

ワークフロー:
- Startノードにparagraph型の変数 `question` を必須で作る（変数名は必ず question）
- ファイルを受け取りたい場合はfile型の変数 `file` を任意で追加する
- それ以外の変数を追加してもよいが、必ず required: false にする

---

## 対応ファイル形式

| 分類 | 拡張子 |
|------|--------|
| 画像 | .jpg, .jpeg, .png, .gif, .webp |
| 文書 | .pdf, .doc, .docx, .xls, .xlsx, .ppt, .pptx |
| データ | .csv, .txt, .md, .json, .xml, .html |
| 音声 | .mp3, .wav |
| 動画 | .mp4, .webm, .mov |
